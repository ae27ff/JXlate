<!doctype html>
<html>
    <head>

        <title>Byte shift and constant-xor report</title>
        <style>
            #txt{ width:300px; }
            #dec{ width:300px; }
            table{ display: inline-block; }
            
            table, th, td {
                border: 1px solid black;
              }
            
            td{ font-family: "Lucida Console", Monaco, monospace; }
        </style>
        <script>
            
            //Polyfills for outdated browsers
            if (!String.prototype.trim) {
                String.prototype.trim = function () {
                    return this.replace(/^\s+|\s+$/g, '');
                };
            }
            if (!Array.prototype.join) {
                Array.prototype.join = function (delim) {
                    var out = "";
                    for(var i=0;i<this.length;i++){
                        if(out.length>0) out += delim;
                        out += this[i];
                    }
                    return out;
                };
            }
            

            var operation = {
                create:function(type,name,apply){
                    return {
                        type: type,
                        name: name,
                        apply: apply
                    };
                }
            }
            
            var StringUtils = {
                entityMap : {
                    "&": "&amp;",
                    "<": "&lt;",
                    ">": "&gt;",
                    '"': '&quot;',
                    "'": '&#39;',
                    "/": '&#x2F;'
                },
                charMap : {
                    0x00 : "NUL",
                    0x0d : "\\r",
                    0x0a : "\\n"
                },
                cleanUnprintableChars : function(s){ return s.replace(/[^\x20-\x7E\xA0-\xFF]/g, "."); },
                filterPrintable: function(s){
                    for (var i = 0; i < s.length; i++) {
                        var a = s.charCodeAt(i);
                        if (!charfilter(a))
                            return false;
                    }
                    return true;
                },
                toCharCodes : function(s){
                    var o=[];
                    for (var i = 0; i < s.length; i++) {
                        var a = s.charCodeAt(i);
                        o.push(a);
                    }
                    return o;
                },
                fromCharCodes : function(arrCodes){
                    for(var i=0;i<arrCodes.length;i++) arrCodes[i]=+arrCodes[i];//convert to number
                    if(Object.apply){
                        return String.fromCharCode.apply(null, arrCodes);
                    }else{
                        var o = "";
                        for (var i = 0; i < arrCodes.length; i++)
                            o += String.fromCharCode(parseInt(arrCodes[i]));
                        return o;
                    }
                },
                applyCharFunction : function(s, charBiFunction, n){
                    var o = "";
                    for (var i = 0; i < s.length; i++) {
                        var a = s.charCodeAt(i);
                        a = charBiFunction(a, n);
                        o += String.fromCharCode(a);
                    }
                    return o;
                },
                allCharsMatchFilter : function(s, charFilter){
                    for (var i = 0; i < s.length; i++) {
                        var a = s.charCodeAt(i);
                        if (!charFilter(a))
                            return false;
                    }
                    return true;
                },
                isCharPrintable : function(c){
                    return !((c < 0x20 || c > 0x7E) && (c !== 0x0A && c !== 0x0D));
                },
                
                createPrintableCharString : function(c){
                    var sc = String.fromCharCode(c);
                    var printable = StringUtils.isCharPrintable(c);
                    
                    if(typeof StringUtils.charMap[c] !== "undefined"){
                        sc = StringUtils.charMap[c];
                        printable = true;
                    }
                    
                    if(!printable) return c;
                    return c + "(" + StringUtils.escapeHTML(sc) + ")";
                },
                allCharsPrintable : function(s){
                    return StringUtils.allCharsMatchFilter(s, StringUtils.isCharPrintable);
                },
                escapeHTML : function(string){
                    return String(string).replace(/[&<>"'\/]/g, function (s) {
                         return StringUtils.entityMap[s];
                    });
                }
                
            };
            
            

            function charshift(a, n) {
                return (a + n) % 256;
            }
            function charxor(a, n) {
                return a ^ n;
            }


            var ShiftsTool = {
                tryAllBytes : function(s, charfunc, t) {
                    //var t = document.getElementById("tbl");
                    var flt = document.getElementById("flt").checked;
                    for (var n = 0; n < 256; n++) {
                        var strOut = StringUtils.applyCharFunction(s, charfunc, n);
                        var cleanedOut = StringUtils.cleanUnprintableChars(strOut);
                        var decimalOut = StringUtils.toCharCodes(strOut).join(" ");

                        if (flt)
                            if (!StringUtils.allCharsPrintable(strOut))
                                continue;

                        //n - f - d
                        var newRow = t.insertRow();
                        var cellKey = newRow.insertCell(0);
                        var cellOutString = newRow.insertCell(1);
                        var cellOutDecimal = newRow.insertCell(2);


                        var charString = StringUtils.createPrintableCharString(n);

                        cellKey.innerHTML = charString;
                        cellOutString.innerHTML = StringUtils.escapeHTML(cleanedOut);
                        cellOutDecimal.innerHTML = decimalOut;
                    }
                },
            clearreport:function (Parent) {
                //var Parent = document.getElementById('tbl');
                while (Parent.hasChildNodes())
                    Parent.removeChild(Parent.firstChild);
            },
            report:function (s) {
                var r, c;
                var t = document.getElementById("tbls");
                this.clearreport(t);
                r = t.insertRow();
                c = r.insertCell(0);
                c.colSpan = 3;
                c.innerHTML = "<b>All Byte Shifts</b>";
                this.tryAllBytes(s, charshift, t);


                t = document.getElementById("tblx");
                this.clearreport(t);
                r = t.insertRow();
                c = r.insertCell(0);
                c.colSpan = 3;
                c.innerHTML = "<b>All Constant XORs</b>";
                this.tryAllBytes(s, charxor, t);
            },

            report_txt:function () {
                var inpt = document.getElementById("txt");
                var inpd = document.getElementById("dec");
                inpd.value = StringUtils.toCharCodes(inpt.value).join(" ");
                this.report(inpt.value);
            },
            report_dec:function () {
                var inpt = document.getElementById("txt");
                var inpd = document.getElementById("dec");
                
                var decArray = inpd.value.trim().split(" ");
                var string = StringUtils.fromCharCodes(decArray);
                
                inpt.value = string;
                this.report(string);
            },
            report_unk:function () {
                var inpt = document.getElementById("txt");
                var inpd = document.getElementById("dec");
                if (inpd.value !== "")
                    return this.report_dec();
                this.report_txt();
            }
            };






        </script>
    </head>
    <body>
        <h2>Byte Shifts/Xor Report v1.2</h2>
        <hr>
        <input type="text" id="txt" placeholder="Text"><input type="submit" value="Generate Report" onclick="ShiftsTool.report_txt()"> <i>OR</i><br>
        <input type="text" id="dec" placeholder="Decimal values"><input type="submit" value="Generate Report" onclick="ShiftsTool.report_dec()"><br>
        <input type="checkbox" id="flt" onclick="ShiftsTool.report_unk()"> Filter strings with unprintable chars.
        <hr>

        <table border="1" id="tbls">
        </table><table border="1" id="tblx">
        </table>


    </body>
</html>

